<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>ตรวจสอบตำแหน่ง</title>
    <style>
      body{font-family:'Prompt',sans-serif;max-width:600px;margin:0 auto;padding:20px;background:#f0f8ff;text-align:center}
      .container{background:#fff;padding:25px;border-radius:15px;box-shadow:0 4px 15px rgba(0,0,0,.1)}
      h1{color:#2c3e50;margin-bottom:20px}
      button{background:#3498db;color:#fff;border:0;padding:12px 25px;border-radius:8px;cursor:pointer;font-size:16px;transition:background .3s}
      button:hover{background:#2980b9}
      #status{margin-top:20px;padding:15px;border-radius:8px;font-weight:bold}
      .success{background:#d4edda;color:#155724}
      .error{background:#f8d7da;color:#721c24}
      .loading{background:#d1ecf1;color:#0c5460}
      #map{height:300px;margin-top:20px;border-radius:8px}
      .location-info{margin-top:15px;padding:10px;background:#f8f9fa;border-radius:8px;text-align:left}
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ตรวจสอบตำแหน่ง</h1>
      <button id="checkLocation">ตรวจสอบตำแหน่งของฉัน</button>
      <div id="status"></div>
      <div id="locationInfo" class="location-info" style="display:none;"></div>
      <div id="map"></div>
    </div>

    <script>
(function() {
  var b = "https://script.google.com/macros/s/AKfycbwM6sOizdhdNDBd_tAANDmBt0-Ont8QaeG84HZOx4EGSzBj-Zh1zIlgXwespafkLQrFPA/exec";
  document.getElementById("checkLocation").addEventListener("click", checkLocation);
  function jsonp(d, e, f) {
    if (e === undefined) { e = {}; }
    if (f === undefined) { f = "callback"; }
    return new Promise(function(g, h) {
      var i = "cb_" + Math.random().toString(36).slice(2);
      e[f] = i;
      var j = new URL(d);
      Object.entries(e).forEach(function(k) { j.searchParams.append(k[0], k[1]); });
      var l = document.createElement("script");
      window[i] = function(m) { cleanup(); g(m); };
      l.onerror = function() { cleanup(); h(new Error("JSONP request failed")); };
      l.src = j.toString();
      document.body.appendChild(l);
      function cleanup() {
        try { delete window[i]; } catch (o) {}
        if (l && l.parentNode) { l.parentNode.removeChild(l); }
      }
    });
  }
  async function getPublicIp() {
    try {
      var d = await jsonp("https://api.ipify.org/", { format: "jsonp" }, "callback");
      return d && d.ip ? d.ip : "";
    } catch (e) {
      return "";
    }
  }
  function checkLocation() {
    var d = document.getElementById("status");
    var e = document.getElementById("locationInfo");
    d.className = "loading";
    d.textContent = "กำลังตรวจสอบตำแหน่ง...";
    e.style.display = "none";
    if (!navigator.geolocation) {
      d.className = "error";
      d.textContent = "เบราว์เซอร์ของคุณไม่รองรับ Geolocation API";
      return;
    }
    navigator.geolocation.getCurrentPosition(async function(f) {
      var g = f.coords.latitude;
      var h = f.coords.longitude;
      e.style.display = "block";
      e.innerHTML = "\n\t\t\t <strong>\u0e02\u0e49\u0e2d\u0e21\u0e39\u0e25\u0e15\u0e33\u0e41\u0e2b\u0e19\u0e48\u0e07\u0e02\u0e2d\u0e07\u0e04\u0e38\u0e13:</strong><br>\n\t\t\t \u0e25\u0e30\u0e15\u0e34\u0e08\u0e39\u0e14: " + g.toFixed(6) + "<br>\n\t\t\t \u0e25\u0e2d\u0e07\u0e08\u0e34\u0e08\u0e39\u0e14: " + h.toFixed(6) + "\n\t\t\t ";
      var i = await getPublicIp();
      var j = { latitude: g.toFixed(6), longitude: h.toFixed(6), ip: i };
      jsonp(b, j, "callback").then(function(k) {
        if (k && k.status === "Success") {
          var l = k.distance != null ? Number(k.distance).toFixed(2) : "-";
          var m = k.isWithinRadius;
          d.className = m === true ? "success" : m === false ? "error" : "loading";
          d.innerHTML = k.isWithinRadius == null ? "\u0e42\u0e1b\u0e23\u0e14\u0e2d\u0e19\u0e38\u0e0d\u0e32\u0e15\u0e43\u0e2b\u0e49\u0e40\u0e02\u0e49\u0e32\u0e16\u0e36\u0e07\u0e15\u0e33\u0e41\u0e2b\u0e19\u0e48\u0e07\u0e40\u0e1e\u0e37\u0e48\u0e2d\u0e15\u0e23\u0e27\u0e08\u0e2a\u0e2d\u0e1a" : "\u0e04\u0e38\u0e13\u0e2d\u0e22\u0e39\u0e48\u0e2b\u0e48\u0e32\u0e07\u0e08\u0e32\u0e01\u0e08\u0e38\u0e14\u0e21\u0e38\u0e48\u0e07\u0e2b\u0e21\u0e32\u0e22 " + l + " \u0e01\u0e34\u0e42\u0e25\u0e40\u0e21\u0e15\u0e23<br>\n\t\t\t \u0e2f\u0e2f\u0e2f" + (m ? "\u2705 \u0e2d\u0e22\u0e39\u0e48\u0e43\u0e19\u0e23\u0e31\u0e28\u0e21\u0e35\u0e17\u0e35\u0e48\u0e01\u0e33\u0e2b\u0e19\u0e14" : "\u274c \u0e44\u0e21\u0e48\u0e2d\u0e22\u0e39\u0e48\u0e43\u0e19\u0e23\u0e31\u0e28\u0e21\u0e35\u0e17\u0e35\u0e48\u0e01\u0e33\u0e2b\u0e19\u0e14");
          showMap(g, h);
        } else {
          d.className = "error";
          d.innerHTML = "\u274c \u0e40\u0e01\u0e34\u0e14\u0e02\u0e49\u0e2d\u0e1c\u0e34\u0e14\u0e1e\u0e25\u0e32\u0e14: " + (k && k.message || "Unknown");
        }
      }).catch(function(k) {
        d.className = "error";
        d.innerHTML = "\u274c JSONP Error: " + k.message;
      });
    }, function(f) {
      d.className = "error";
      d.textContent = "\u0e40\u0e01\u0e34\u0e14\u0e02\u0e49\u0e2d\u0e1c\u0e34\u0e14\u0e1e\u0e25\u0e32\u0e14: " + f.message;
    });
  }
  function showMap(d, e) {
    var f = document.getElementById("map");
    f.innerHTML = "\n\t\t\t <iframe\n\t\t\t \t width=\"100%\" height=\"100%\" frameborder=\"0\" scrolling=\"no\"\n\t\t\t \t src=\"https://maps.google.com/maps?q=$" + d + "," + e + "&hl=th&z=15&output=embed\">\n\t\t\t <\/iframe>\n\t\t\t ";
  }
})();
    </script>
  </body>
</html>
